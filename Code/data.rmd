---
title: "Housing Data"
output: html_notebook
---

```{r}
library(dplyr)
library(reshape2)
library(lubridate)
```

```{r}
rates <- read.csv('mortgage_rate.csv', header=TRUE)

#convert DATE column to date format
rates$DATE <- as.Date(rates$DATE, format = "%m/%d/%y")

#add year and month columns to later merge with other data
rates$year <- year(rates$DATE)
rates$month <- month(rates$DATE, label=TRUE)

#keep only the first instance of rate data for each month
rates_1st <- aggregate(MORTGAGE30US ~ month + year, rates, FUN = function(x) x[1])

head(rates_1st)
```
```{r}
cpi <- read.csv('cpi.csv', header=TRUE)

#melt monthly columns to one column
cpi_transform <- melt(cpi, id.vars = "Year", variable.name = "month", value.name = "cpi") %>% rename(year = Year)

head(cpi_transform)
```

```{r}
listings <- read.csv('active_listing.csv', header=TRUE)

#convert DATE column to date format
listings$observation_date <- as.Date(listings$observation_date, format = "%Y-%m-%d")

#add year and month columns to later merge with other data
listings$year <- year(listings$observation_date)
listings$month <- month(listings$observation_date, label=TRUE)

head(listings)
```

```{r}
value_index <- read.csv('zillow_home_value_index.csv', header=TRUE)
head(value_index)
```

```{r}
pop_2010_2020 <- read.csv('population_2010_2020.csv', header=TRUE)
pop_2020_2022 <- read.csv('population_2020_2022.csv', header=TRUE)
pop_2010_2022 <- merge(pop_2010_2020, pop_2020_2022, by = c("STATE", "COUNTY", "STNAME", "CTYNAME"))
pop_10_22 <- pop_2010_2022[, c("STATE", "COUNTY", "STNAME", "CTYNAME", "POPESTIMATE2010", "POPESTIMATE2011", "POPESTIMATE2012", "POPESTIMATE2013", "POPESTIMATE2014", "POPESTIMATE2015", "POPESTIMATE2016", "POPESTIMATE2017", "POPESTIMATE2018", "POPESTIMATE2019", "POPESTIMATE2020.y", "POPESTIMATE2021", "POPESTIMATE2022")]

sig_pop <- pop_10_22 %>% filter(COUNTY != 0, POPESTIMATE2022 > 2000000)

county_list <- sig_pop[order(sig_pop$STATE), 1:4]
county_list
```

```{r}
#create months dataframe for merging
months_seq <- seq(from = as.Date("2010-01-01"), to = as.Date("2023-05-01"), by = "1 month")
years <- year(months_seq)
months <- month(months_seq, label=TRUE)

T1 <- data.frame(date = months_seq, year = years, month = months)

#merge mortgage rate data
T1_mortgage <- merge(T1, rates_1st, by = c("year", "month"), all.x=TRUE) %>% arrange(date)

#merge cpi data
T1_mortgage_cpi <- merge(T1_mortgage, cpi_transform, by = c("year", "month"), all.x=TRUE) %>% arrange(date)

#merge active listings data
T1_mortgage_cpi_listings <- merge(T1_mortgage_cpi, listings, by = c("year", "month"), all.x=TRUE) %>% arrange(date)

```

```{r}
#plot mortgage rates
plot(T1_mortgage$date, T1_mortgage$MORTGAGE30US, type="l", xlab="Date", ylab="Rate", main="mortgage_rate")
```

```{r}
#plot cpi
plot(T1_mortgage_cpi$date, T1_mortgage_cpi$cpi, type="l", xlab="Date", ylab="CPI", main="CPI")
```

```{r}
#plot active listings
plot(T1_mortgage_cpi_listings$date, T1_mortgage_cpi_listings$ACTLISCOUUS, type="l", xlab="Date", ylab="Active Listings", main="Active Listings")
```

